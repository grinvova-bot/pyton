# КОНТЕКСТ ПРОЕКТА: ПРАЙС-ЛИСТ ООО "АЛЬТ-ИКС"

## 1. ОБЩЕЕ ОПИСАНИЕ
Проект представляет собой SaaS-решение (или скрипт) для автоматической обработки, очистки, расчета спеццен и форматирования прайс-листов строительных материалов.
**Входные данные:** Excel файлы со сложной структурой (объединенные ячейки, мусор, повторяющиеся шапки).
**Выходные данные:** Стандартизированный Excel файл строго по шаблону `Temlate2-color.xlsx`.

## 2. ЛОГИКА ОБРАБОТКИ ДАННЫХ (BUSINESS LOGIC)

### 2.1. Очистка данных (Data Cleaning)
Необходимо удалить из выходного файла:
- Шапки и подвалы документов ("Прайс-лист ООО...", даты, контакты), кроме утвержденного блока заголовка.
- Заголовки разделов категорий (например, "BOSTIK", "ВД краски DUFA"), если в строке нет кода товара и цены.
- Дубликаты строк заголовков таблицы внутри листа.
- Полностью пустые строки.

### 2.2. Трансформация статусов (Маппинг колонки "Качество"/"Статус")
Анализ исходной колонки статуса/качества и применение правил:
| Исходное значение | Действие | Итоговое значение |
| :--- | :--- | :--- |
| "Новый", "new", "новинка" | Очистка | *(Пустая ячейка)* |
| "Ограничено годен", "срок годности", "брак", "уценка" | Замена | **РАСПРОДАЖА** |
| "Распродажа", "sale", "акция" | Унификация | **РАСПРОДАЖА** |
| Найдены маркеры акций (К2, К3, Л3) | Авто-заполнение | **РАСПРОДАЖА** |
| Найден маркер `К4` | Проверка | **РАСПРОДАЖА** |

### 2.3. Расчет специальных цен (Логика с приоритетами)
Сканирование названия товара и статуса на наличие маркеров: `К2`, `К3`, `К4`, `Л3`.

**АЛГОРИТМ:**
1.  **ПРОВЕРКА НА `К4` (ИСКЛЮЧЕНИЕ):**
    - Если найден маркер `К4`:
        - Проверить колонку `Спец. цена` в исходнике.
        - **ЕСЛИ цена есть:** КОПИРОВАТЬ БЕЗ ИЗМЕНЕНИЙ. Формула скидки НЕ применяется.
        - **ЕСЛИ цены нет:** Оставить пустой (или как в исходнике).
        - Статус -> `РАСПРОДАЖА`.
        - *Переход к следующему товару.*

2.  **ОБРАБОТКА ОСТАЛЬНЫХ (`К2`, `К3`, `Л3`):**
    - Если найден маркер (и это не К4):
        - Взять `Розничная цена`.
        - Применить процент скидки $P$ (задается пользователем в интерфейсе).
        - **ФОРМУЛА:** `Цена_спец = ОКРУГЛ(Розничная * (1 - P/100); 0)`
          *(Математическое округление до целого числа, аналог Excel `ОКРУГЛ(...; 0)`)*.
        - Статус -> `РАСПРОДАЖА`.

*Примечание:* Коэффициенты скидок по умолчанию (настраиваемые): К2=30%, К3=40%, Л3=50%.

## 3. ТРЕБОВАНИЯ К ОФОРМЛЕНИЮ ВЫХОДНОГО ФАЙЛА (ШАБЛОН)
Строго следовать структуре файла `Temlate2-color.xlsx`.

### 3.1. Структура шапки (Строки 1-7)
- **Строка 1:** `Прайс-лист ООО "АЛЬТ-Икс"` (Жирный, 14-16pt).
- **Строка 2:** Пустая.
- **Строка 3:** `дата: [ДД] [месяц прописью] [ГГГГ] г.` (Например: `дата: 18 февраля 2026 г.`).
- **Строка 4:** Пустая.
- **Строка 5:** `Ответственный: [ФИО]` (По умолчанию: `Сидорова О.О.`).
- **Строка 6 (Заголовки):** `Код товара` | `Статус` | `Номенклатура` | `Спец. цена` | `Розничная цена`.
- **Строка 7:** (Дополнительные подписи или объединение, согласно шаблону).

### 3.2. Цветовая схема (Color Scheme)
- **Шапка таблицы (Заголовки):**
    - Фон: Светло-желтый/Оранжевый (HEX: `#FFD966`).
    - Текст: Черный, Жирный.
    - Границы: Тонкие черные.
- **Тело таблицы:**
    - Фон: Белый.
    - Границы: Тонкие черные.
- **Условное форматирование (Акции):**
    - Если статус = `РАСПРОДАЖА`:
        - Фон ячейки статуса: Светло-красный (HEX: `#FFCCCC`).
        - ИЛИ выделение всей строки/цены красным цветом (согласно шаблону).

### 3.3. Форматирование данных
- **Цены:** Целые числа, разделитель тысяч — пробел (например: `6 781`), без копеек, без знака валюты внутри ячейки.
- **Шрифт данных:** Arial/Calibri, 10-11pt.

## 4. ПАРАМЕТРЫ СТРАНИЦЫ И ПЕЧАТИ (PAGE SETUP)
- **Ориентация:** Альбомная (Landscape).
- **Поля:** Верхнее 2.0 см, Нижнее 1.5 см, Левое/Правое 1.5 см.
- **Масштаб:** "Вместить по ширине" (Fit to width: 1 page).
- **Сквозные строки (Print Titles):** Повторять строки `$1:$7` на каждой странице.
- **Колонтитулы:**
    - Верхний: Пусто.
    - Нижний: Номер страницы (`Страница 1 из N`).

## 5. ТЕХНИЧЕСКИЕ ДЕТАЛИ РЕАЛИЗАЦИИ
- **Язык:** Python.
- **Библиотеки:** `pandas` (обработка данных), `openpyxl` или `xlsxwriter` (стилизация и экспорт).
- **Округление:** Использовать `decimal.Decimal` или формулу `int(x + 0.5)` для эмуляции банковского округления Excel.
- **Поиск данных:** Эвристический поиск начала таблицы по заголовкам "Код товара" и "Номенклатура".

## 6. ЧЕК-ЛИСТ ПРОВЕРКИ (ACCEPTANCE CRITERIA)
1. [ ] В файле есть шапка с ООО "АЛЬТ-Икс", датой и Ответственным.
2. [ ] Заголовки таблицы желтые (`#FFD966`), текст черный жирный.
3. [ ] Цены целые, с пробелом как разделителем тысяч.
4. [ ] Товары "Новый" имеют пустой статус.
5. [ ] Товары "Ограничено годен" переименованы в "РАСПРОДАЖА".
6. [ ] Товары с меткой `К4` имеют цену из исходника (без пересчета).
7. [ ] Товары с меткой `К2`/`К3` имеют цену, рассчитанную по формуле с округлением.
8. [ ] Ориентация страницы — альбомная, настроены сквозные строки.
9. [ ] В нижнем колонтитуле есть нумерация страниц.