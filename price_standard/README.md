# Прайс-Стандарт

SaaS-сервис автоматической обработки и стандартизации прайс-листов.

## Возможности

- **Загрузка Excel-файлов** (.xlsx, .xls)
- **Автоматическая очистка данных**:
  - Удаление шапок и подвалов документов
  - Удаление заголовков разделов
  - Удаление дубликатов заголовков
  - Удаление пустых строк
- **Нормализация статусов**:
  - "Новый", "new", "новинка" → (пусто)
  - "Ограниченно годен", "брак", "уценка" → "РАСПРОДАЖА"
  - "Распродажа", "sale", "акция" → "РАСПРОДАЖА"
- **Расчёт специальных цен**:
  - Маркер К2: скидка 30% (настраивается)
  - Маркер К3: скидка 40% (настраивается)
  - Маркер К4: цена берётся из файла без пересчёта
  - Маркер Л3: скидка 50% (настраивается)
- **Оформление по стандарту**:
  - Единый шрифт Arial
  - Формат цен: # ##0 ₽
  - Выделение строк с распродажей красным
  - Автофильтр по заголовкам
  - Автоподбор ширины колонок

## Установка

```bash
pip install -r requirements.txt
```

## Запуск

```bash
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

Откройте в браузере: http://localhost:8000

## Структура проекта

```
price_standard/
├── app/
│   ├── core/           # Конфигурация и утилиты
│   │   ├── config.py   # Настройки приложения
│   │   └── utils.py    # Вспомогательные функции
│   ├── models/         # Модели данных
│   │   └── schemas.py  # Pydantic схемы
│   ├── services/       # Бизнес-логика
│   │   ├── parser.py   # Парсинг Excel
│   │   ├── cleaner.py  # Очистка данных
│   │   ├── transformer.py  # Трансформация данных
│   │   ├── exporter.py # Экспорт в Excel
│   │   └── processor.py # Основной процессор
│   └── main.py         # FastAPI приложение
├── templates/          # HTML шаблоны
├── static/             # Статические файлы
├── uploads/            # Временные загруженные файлы
└── output/             # Обработанные файлы
```

## API

### POST /process
Обработка прайс-листа

**Параметры:**
- `file` (file): Excel-файл для обработки
- `k2_discount` (int): Скидка для К2 (%)
- `k3_discount` (int): Скидка для К3 (%)
- `l3_discount` (int): Скидка для Л3 (%)
- `recalculate_existing` (bool): Пересчитывать существующие цены

**Ответ:**
```json
{
  "success": true,
  "message": "Обработано 1627 строк, из них 124 с распродажей",
  "output_filename": "Прайс_Стандарт_20260218_143022.xlsx",
  "download_url": "/download/Прайс_Стандарт_20260218_143022.xlsx"
}
```

### GET /download/{filename}
Скачивание обработанного файла

### GET /health
Проверка работоспособности сервиса

## Алгоритм обработки

1. **Загрузка файла** → временное хранилище
2. **Парсинг** → чтение данных из Excel
3. **Очистка** → удаление служебной информации
4. **Нормализация статусов** → маппинг значений
5. **Расчёт цен** → применение скидок по маркерам
6. **Экспорт** → оформление и сохранение

## Особенности обработки К4

Товары с маркером **К4** считаются особыми акционными позициями:
- Если в колонке "Спец. цена" уже есть значение → цена **не пересчитывается**
- Статус устанавливается в **"РАСПРОДАЖА"**
- Строка выделяется красным цветом

## Безопасность

- Файлы хранятся во временном хранилище не более 24 часов
- Рекомендуется использовать HTTPS в продакшене
- Максимальный размер файла: 10 MB

## Производительность

Обработка файла до 15 000 строк занимает ~30-40 секунд.
